<!DOCTYPE html>
<html>
<head>
    <title>Mostruário de Motos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <h1 class="mb-4 text-center" style="color: rgb(87, 86, 86);">Motos disponíveis</h1>
            <div style="position: absolute; top: 10px; right: 10px;">
                <a href="/login" class="btn btn-link text-muted" style="font-size: 0.8em;">Admin</a>
            </div>
            <form method="GET" class="mb-4">
                <div class="row g-2">
                    <div class="col-md-2">
                    <select name="marca" class="form-select">
                        <option value="">Todas as marcas</option>
                        {% for m in marcas %}
                        <option value="{{ m }}" {% if m == marca %}selected{% endif %}>{{ m }}</option>
                        {% endfor %}
                    </select>
                    </div>
                    <div class="col-md-2">
                    <select name="modelo" class="form-select">
                        <option value="">Todos os modelos</option>
                        {% for mod in modelos %}
                        <option value="{{ mod }}" {% if mod == modelo %}selected{% endif %}>{{ mod }}</option>
                        {% endfor %}
                    </select>
                    </div>
                    <div class="col-md-2">
                    <select name="ano" class="form-select">
                        <option value="">Todos os anos</option>
                        {% for a in anos %}
                        <option value="{{ a }}" {% if a == ano %}selected{% endif %}>{{ a }}</option>
                        {% endfor %}
                    </select>
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-outline-secondary w-100">Filtrar</button>
                    </div>
                    <div class="col-md-2 mt-2">
                        <a href="/" class="btn btn-outline-secondary">Limpar filtros</a>
                    </div>
                </div>
            </form>
        
        <div class="row">
            {% for moto in motos %}
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm border-0">
                   <div id="carousel{{ moto[0] }}" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                                {% set imagens = moto[6].split(';') if moto[6] else ['default.jpg'] %}
                                {% for img in imagens %}
                                <div class="carousel-item {% if loop.index == 1 %}active{% endif %}">
                                    <img src="{{ url_for('static', filename='imagens/' ~ img) }}" class="d-block w-100" style="max-height: 250px; object-fit: cover;" alt="Imagem da moto">
                                </div>
                                {% endfor %}
                                </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ moto[0] }}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Anterior</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ moto[0] }}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Próxima</span>
                            </button>
                        </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ moto[1] }} - {{ moto[2] }}</h5>
                        <p class="card-text">
                            Ano: {{ moto[3] }}<br>
                            Valor: {{ moto[4]|moeda }}<br>
                            {{ moto[5] }}
                        </p>
                        <a href="https://wa.me/5548996527662?text={{ 'OOI tudo bem? Me chamo Sabrina e vou ajudar você a acelerar o seu sonho.\nMe conta, qual moto você mais gostou? ' | urlencode }}" class="btn btn-success w-100 animate__animated animate__fadeInUp" target="_blank" style="background-color: rgb(155, 150, 150);">Falar comigo</a>
                    </div>
                
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Bootstrap JS (necessário para o carrossel funcionar) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const marcaSelect = document.querySelector('select[name="marca"]');
        const modeloSelect = document.querySelector('select[name="modelo"]');
        const anoSelect = document.querySelector('select[name="ano"]');
        const motosContainer = document.querySelector('.row');

        function atualizarLista() {
            const marca = marcaSelect.value;
            const modelo = modeloSelect.value;
            const ano = anoSelect.value;

            fetch(`/filtrar?marca=${marca}&modelo=${modelo}&ano=${ano}`)
            .then(res => res.json())
            .then(data => {
                motosContainer.innerHTML = '';
                data.forEach(moto => {
                motosContainer.innerHTML += `
                    <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-body">
                        <h5 class="card-title">${moto[2]} ${moto[3]}</h5>
                        <p class="card-text">Ano: ${moto[4]}</p>
                        <p class="card-text">Preço: R$ ${moto[5]}</p>
                        </div>
                    </div>
                    </div>
                `;
                });
            });
        }

        marcaSelect.addEventListener('change', atualizarLista);
        modeloSelect.addEventListener('change', atualizarLista);
        anoSelect.addEventListener('change', atualizarLista);
    </script>
</body>

</html>
